{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h2>{{ 'Editar' if registro else 'Nuevo' }} Convertido</h2>
    <form method="post">
        <div class="row mb-3">
            <div class="col">
                <label>Nombres:</label>
                <input type="text" name="nombres" class="form-control" value="{{ registro.nombres if registro else '' }}" required>
            </div>
            <div class="col">
                <label>Apellidos:</label>
                <input type="text" name="apellidos" class="form-control" value="{{ registro.apellidos if registro else '' }}" required>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col">
                <label>Edad:</label>
                <input type="number" name="edad" class="form-control" min="0" max="150" value="{{ registro.edad if registro else '' }}" required>
            </div>
            <div class="mb-3">
                <label for="contacto" class="form-label">Telefono:</label>
                <input type="text" class="form-control" id="contacto" name="contacto" 
                    value="{{ registro.contacto if registro else '' }}" 
                    maxlength="9" oninput="formatearTelefono(this)" required>
            </div>
            <div class="col">
                <label>Domicilio:</label>
                <input type="text" name="domicilio" class="form-control" value="{{ registro.domicilio if registro else '' }}">
            </div>
        </div>
        <div class="mb-3">
    <label for="invito" class="form-label">Invitó:</label>
    <input type="text" class="form-control" id="invito" name="invito"
           value="{{ registro.invito if registro else '' }}">
        </div>
        <div class="row mb-3">
            <div class="col">
                <label>Tipo Validación:</label>
                <select name="id_validacion" class="form-control" required>
                    {% for val in tipo_validaciones %}
                        <option value="{{ val.id }}" {% if registro and val.id == registro.id_validacion %}selected{% endif %}>{{ val.descripcion }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col">
                <label>Lugar Conversión:</label>
                <select name="id_lugar" class="form-control" required>
                    {% for lugar in lugares_conversion %}
                        <option value="{{ lugar.id }}" {% if registro and lugar.id == registro.id_lugar %}selected{% endif %}>{{ lugar.descripcion }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="mb-3">
    <label for="fecha_conversion" class="form-label">Fecha Conversión:</label>
    <input type="date" class="form-control" id="fecha_conversion" name="fecha_conversion" 
           style="max-width: 250px;" 
           value="{{ registro.fecha_conversion.strftime('%Y-%m-%d') if registro and registro.fecha_conversion else '' }}">
</div>
<div class="mb-3 form-check">
    <input type="checkbox" id="usar_fecha_actual" name="usar_fecha_actual">
    <label for="usar_fecha_actual">Usar fecha actual</label>
</div>


        <button type="submit" class="btn btn-success">Guardar</button>
        <a href="{{ url_for('convertido.index') }}" class="btn btn-secondary">Cancelar</a>
    </form>
</div>
<script>
function formatearTelefono(input) {
    let value = input.value.replace(/[^0-9]/g, ''); // eliminamos todo lo que no es número
    if (value.length > 4) {
        input.value = value.substring(0, 4) + '-' + value.substring(4, 8);
    } else {
        input.value = value;
    }
}
</script>
<script>
    document.getElementById("usar_fecha_actual").addEventListener("change", function() {
        const fechaInput = document.getElementById("fecha_conversion");
        if (this.checked) {
            const hoy = new Date();
            const dia = ("0" + hoy.getDate()).slice(-2);
            const mes = ("0" + (hoy.getMonth() + 1)).slice(-2);
            const anio = hoy.getFullYear();
            fechaInput.value = `${anio}-${mes}-${dia}`;
        } else {
            fechaInput.value = "";
        }
    });
</script>


{% endblock %}
